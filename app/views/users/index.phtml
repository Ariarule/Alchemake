<?php $this->flashSession->output();

echo "<h2>Welcome {$userinfo->nickname}</h2>";
$possible_f = ['T' => function () use ($userinfo) { //trades
    echo "<h3>Trades</h3>";
    $trade_types = [['field' => 'proposer',
                        'label' => 'You have suggested:',
                        'actions' => ['withdraw']],
                    ['field' => 'proposed',
                        'label' => 'Others have suggested:',
                        'actions' => ['reject', 'counteroffer']]];
        foreach ($trade_types as $trade_type) {
            echo "<h4>{$trade_type['label']}</h4>";
            $trades = Trades::findAcceptableByUserId($userinfo->userid,
                    $trade_type['field']);
            if ($trades->count() > 0) {
                echo "<ul>";    
                foreach ($trades as $trade) {
                    echo "<li>{$trade->proposer->nickname} &amp;"
                    . " {$trade->proposed->nickname}</li>";
                }
                echo "</ul>";
            }
            else {
                echo "...no pending trades.";
            }
        }
    //print_r();
  },

  'I' => function () use ($userinfo) { //inventory
    echo "<h3>Your Inventory</h3>";

    if ($userinfo->inventory->count() > 0) {
     $form_buttons = '<button formaction="/Trade/setupProposal" type="submit">Trade</button>&nbsp;'
     . '<button formaction="/Inventory/alchemake" type="submit">Alchemake'
     .'</button>';
     $this->partial('shared/inventoryTable',
        ['form_buttons' => $form_buttons,
         'inventory' => $userinfo->inventory]);
}
else {
  echo "You have no inventory right now. :(";
}   

  },

  'U' => function () use ($userinfo) { //usercard
    ?><!--
    <?php echo "{$userinfo->userid}"; ?>
    -->
    <h3>Usercard</h3>
    <div id="userinfo">
      <ul>
        <li>Basic item delivery: <?= explode($userinfo->last_drop,' ')[0] ?></li>
        <li>AY Allowence: <?= explode($userinfo->last_allowence,' ')[0] ?></li>
        <li>Email Address: <?= $userinfo->emailaddress ?></li>
      </ul>
    </div>
    <?php
  }];

foreach (str_split($userinfo->main_order,1) as $section) {
  if (isset($possible_f[$section])) {
    $possible_f[$section]();
  }
}
?>
